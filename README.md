# Tobii Eye Gaze Data Streamer

This repository contains a **local Flask-based application** designed to stream Tobii eye tracker data to a server for integration with [ShowMe.News](https://showme.news). The application provides real-time gaze data streaming, allowing eye gaze tracking for research and experimental setups.

---

## Features

* **Flask Web Application** – Serves as the main backend.
* **Tobii Eye Tracker Integration** – Streams gaze data in real time.
* **Socket.IO Support** – Enables low-latency data transfer.
* **Executable Build** – Uses `pyinstaller` to package the app into a standalone `.exe`.
* **Cross-Origin Access** – Enabled via Flask-CORS.
* **Session Management** – Uses server-side sessions with Flask-Session.

---

## Project Structure

```
etta-tobii-v2/
│── app/
│   ├── __init__.py      # Initializes Flask app, CORS, SocketIO, and sessions
│   ├── config.py        # Configuration settings
│   └── routes.py        # Main logic for gaze data streaming
│
│── build/               # Generated by PyInstaller (temporary build files)
│── dist/                # Contains the compiled executable
│── plos_exp.py          # Main entry point for the application
│── requirements.txt     # Python dependencies
│── run_pattie.ps1       # Script to run the Flask app locally
│── README.md            # Project documentation
```

---

## Installation & Setup

### Create and activate a virtual environment

```bash
python -m venv tobii_streamer_env
source tobii_streamer_env/bin/activate   # For macOS/Linux
.\tobii_streamer_env\Scripts\activate    # For Windows (PowerShell)
```

### Install dependencies

```bash
pip install -r requirements.txt
```

### Run the Flask app (development mode)

```powershell
# Windows PowerShell
.\run_pattie.ps1
```

---

## Building the Executable

To create a standalone `.exe`:

```bash
pyinstaller --onefile --hidden-import "engineio.async_drivers.threading" .\plos_exp.py
```

* The build artifacts will be created in:

  * `build/` → Temporary files
  * `dist/plos_exp.exe` → Final executable
* Once compiled, you can run the `.exe` directly (after connecting and calibrating your Tobii device).

---

## Usage Instructions

1. Connect your **Tobii Eye Tracker** device.
2. Perform calibration using [Tobii Pro Eye Tracker Manager](https://connect.tobii.com/s/etm-downloads?language=en_US).
3. Launch the application:

   * **Development:** Run `run_pattie.ps1`
   * **Executable:** Run `dist/plos_exp.exe`
4. The application will start a local server on **port 5000**, streaming gaze data via Socket.IO.
5. Open showme.news and the gaze data should be useable for control in place of mouse movements.

---

## Code Overview

### **plos\_exp.py**

```python
from app import app
from waitress import serve

if __name__ == "__main__":
    serve(app, host="0.0.0.0", port=5000)
```

### **Gaze Streaming Logic (`routes.py`)**

* Finds connected Tobii device
* Subscribes to gaze data
* Emits coordinates `(x, y)` to clients via Socket.IO
* Can be started with `start_gaze` event

---

## Requirements

* **Python:** 3.8
* **Dependencies:**

```txt
Flask==3.0.3
Flask-Bootstrap==3.3.7.1
Flask-Cors==4.0.1
Flask-Session==0.8.0
Flask-SocketIO==5.5.1
numpy==1.23.5
pandas==1.5.3
tobii-research==1.10.1
matplotlib==3.7.5
matplotlib-inline==0.1.7
tqdm==4.66.4
waitress==3.0.0
```

Install with:

```bash
pip install -r requirements.txt
```

---

## Output

* **Executable:** `dist/plos_exp.exe`
* **Server:** Runs on `http://localhost:5000`
* **Data Stream:** Emits `gaze_data` events with real-time `(x, y)` coordinates

---

## Notes

* Ensure Tobii drivers and calibration software are installed before running.
* For production deployment, consider using `waitress` or similar WSGI servers.
* The app uses **threading** for non-blocking gaze data streaming.

---